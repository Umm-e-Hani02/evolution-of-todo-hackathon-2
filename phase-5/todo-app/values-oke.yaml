# Phase-5 Todo App Helm Chart Values for Oracle OKE (Cloud Deployment)
# This file overrides values.yaml for cloud deployment

# Global settings
global:
  minikube: false  # Cloud deployment, not Minikube

# Backend configuration
backend:
  enabled: true
  replicaCount: 1

  image:
    repository: <DOCKERHUB_USERNAME>/phase5-backend  # REPLACE with your Docker Hub username
    pullPolicy: IfNotPresent  # Pull from Docker Hub if not present locally
    tag: "latest"

  service:
    type: ClusterIP  # Internal only - not exposed to internet
    port: 8000

  env:
    - name: DATABASE_URL
      value: "sqlite:///./data/phase5.db"
    - name: OPENAI_API_KEY
      valueFrom:
        secretKeyRef:
          name: todo-app-secrets
          key: openai-api-key
    - name: OPENAI_MODEL
      value: "meta-llama/llama-3.2-3b-instruct:free"
    - name: JWT_SECRET
      valueFrom:
        secretKeyRef:
          name: todo-app-secrets
          key: jwt-secret
    - name: JWT_ALGORITHM
      value: "HS256"
    - name: JWT_EXPIRATION_HOURS
      value: "24"
    - name: CORS_ORIGINS
      value: "http://<FRONTEND_EXTERNAL_IP>:3000"  # UPDATE after LoadBalancer IP is assigned
    - name: HOST
      value: "0.0.0.0"
    - name: PORT
      value: "8000"
    - name: DEBUG
      value: "false"  # Production mode

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  persistence:
    enabled: true
    storageClass: oci-bv  # Oracle Block Volume storage class
    accessMode: ReadWriteOnce
    size: 1Gi
    mountPath: /app/data

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 1

  image:
    repository: <DOCKERHUB_USERNAME>/phase5-frontend  # REPLACE with your Docker Hub username
    pullPolicy: IfNotPresent  # Pull from Docker Hub if not present locally
    tag: "latest"

  service:
    type: LoadBalancer  # Expose to internet with external IP
    port: 3000
    # No nodePort needed for LoadBalancer

  env:
    - name: NEXT_PUBLIC_API_URL
      value: "http://todo-app-backend:8000"  # Internal ClusterIP service name
    - name: NODE_ENV
      value: "production"

  resources:
    limits:
      cpu: 300m
      memory: 256Mi
    requests:
      cpu: 150m
      memory: 128Mi

  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Secrets (will be created separately via kubectl)
secrets:
  # DO NOT set values here - create secrets via kubectl command
  openaiApiKey: ""
  jwtSecret: ""

# Service Account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Pod annotations and labels
podAnnotations: {}
podLabels: {}

# Security contexts
podSecurityContext: {}
securityContext: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Ingress (not used for Phase 5)
ingress:
  enabled: false
